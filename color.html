<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Pixel Art Pro</title>
    <style>
        :root {
            --bg-color: #e3f2fd;
            --cell-size: 35px; /* Dynamic variable for Zoom */
        }

        body {
            font-family: 'Chalkboard SE', 'Comic Sans MS', sans-serif;
            background-color: var(--bg-color);
            margin: 0;
            height: 100vh;
            width: 100vw;
            overflow: hidden; /* Prevent body scroll, we handle it internally */
            display: flex;
            flex-direction: column;
            user-select: none;
            -webkit-user-select: none;
        }

        /* --- Portrait Lock Screen --- */
        #portrait-warning {
            display: none;
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: #1565c0;
            color: white;
            z-index: 9999;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            padding: 20px;
        }

        #portrait-warning h2 { font-size: 2rem; }
        #portrait-warning .icon { font-size: 4rem; margin-bottom: 20px; animation: rotatePhone 2s infinite; }

        @media screen and (orientation: landscape) {
            #portrait-warning { display: flex; }
        }

        @keyframes rotatePhone {
            0% { transform: rotate(-90deg); }
            50% { transform: rotate(0deg); }
            100% { transform: rotate(-90deg); }
        }

        /* --- Main App Layout --- */
        header {
            padding: 15px;
            text-align: center;
            background: white;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            z-index: 10;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        h1 { margin: 0; font-size: 1.2rem; color: #1565c0; }
        
        .header-btn {
            background: #e3f2fd;
            border: none;
            color: #1565c0;
            font-weight: bold;
            padding: 8px 12px;
            border-radius: 12px;
            cursor: pointer;
        }

        /* --- The Viewport (Scrollable Area) --- */
        #viewport {
            flex: 1; /* Takes remaining height */
            position: relative;
            overflow: auto; /* Native scrolling for panning */
            -webkit-overflow-scrolling: touch; /* Smooth momentum scrolling on iOS */
            background-color: #cfd8dc;
            display: flex;
            align-items: center; /* Center grid when zoomed out */
            justify-content: center;
            padding: 50px; /* Space around the grid */
            touch-action: pan-x pan-y;
        }

        /* The Grid Wrapper */
        #grid {
            display: grid;
            gap: 1px;
            background-color: #90a4ae;
            border: 10px solid white;
            border-radius: 4px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
            /* Important: Grid sizing is now controlled by CSS Variable */
            grid-template-columns: repeat(var(--cols), var(--cell-size));
            grid-template-rows: repeat(var(--rows), var(--cell-size));
            transition: all 0.1s ease-out; /* Smooth zoom transition */
        }

        .pixel {
            background-color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            /* Font size scales with cell size */
            font-size: calc(var(--cell-size) * 0.5); 
            color: #ccc;
            cursor: pointer;
        }

        .pixel.filled { color: transparent; }

        /* --- Controls Area (Bottom) --- */
        #bottom-panel {
            background: white;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
            padding: 15px 10px 30px 10px; /* Extra bottom padding for iPad bar */
            z-index: 20;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        /* Zoom Controls */
        #zoom-bar {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            color: #666;
            font-size: 0.9rem;
        }

        input[type=range] {
            width: 60%;
            accent-color: #1565c0;
            height: 25px; /* Taller touch target */
        }

        /* Palette */
        #palette {
            display: flex;
            gap: 12px;
            overflow-x: auto; /* Horizontal scroll if many colors */
            padding: 5px;
            justify-content: flex-start; /* Align left to allow scrolling */
            -webkit-overflow-scrolling: touch;
        }
        
        /* Spacer to center palette items if they fit on screen */
        .palette-spacer { margin: auto; display: flex; gap: 12px; }

        .color-btn {
            flex-shrink: 0;
            width: 55px;
            height: 55px;
            border-radius: 50%;
            border: 4px solid white;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            color: white;
            font-weight: bold;
            text-shadow: 0 1px 2px rgba(0,0,0,0.5);
            transition: transform 0.2s, border-color 0.2s;
        }

        .color-btn.selected {
            border-color: #333;
            transform: scale(1.15);
        }
        
        .color-btn.light-text { color: #333; text-shadow: none; }

        /* Win Overlay */
        #win-message {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(255,255,255,0.95);
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 100;
        }
        
        #win-message h2 { font-size: 3rem; color: #1565c0; margin-bottom: 20px;}
        .big-btn {
            background: #1565c0; color: white; border: none;
            padding: 15px 40px; font-size: 1.5rem; border-radius: 50px;
            font-family: inherit; box-shadow: 0 5px 0 #0d47a1;
        }
        .big-btn:active { transform: translateY(5px); box-shadow: none; }

    </style>
</head>
<body>

    <div id="portrait-warning">
        <div class="icon">üì±</div>
        <h2>Please rotate your iPad</h2>
        <p>This game works best in Portrait Mode.</p>
    </div>

    <header>
        <button class="header-btn" onclick="resetLevel()">‚Ü∫ Reset</button>
        <h1 id="level-title">Level 1</h1>
        <button class="header-btn" onclick="nextLevel()">Next ‚û°</button>
    </header>

    <div id="viewport">
        <div id="grid"></div>
    </div>

    <div id="bottom-panel">
        <div id="zoom-bar">
            <span>üîé -</span>
            <input type="range" id="zoom-slider" min="20" max="70" value="35" oninput="updateZoom(this.value)">
            <span>+ üîç</span>
        </div>
        <div id="palette">
            <div class="palette-spacer" id="palette-content"></div>
        </div>
    </div>

    <div id="win-message">
        <h2>Beautiful! üé®</h2>
        <button class="big-btn" onclick="nextLevel()">Next Picture</button>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <script>
        // --- DATA ---
        const levels = [
            {
                name: "Ragdoll Cat (Detailed)",
                rows: 20,
                cols: 20,
                palette: [
                    { id: 1, color: '#5D4037', label: '1' }, // Dark Points
                    { id: 2, color: '#FFF8E1', label: '2' }, // Cream Body
                    { id: 3, color: '#FFB74D', label: '3' }, // Shading
                    { id: 4, color: '#29B6F6', label: '4' }, // Eyes
                    { id: 5, color: '#F48FB1', label: '5' }  // Nose
                ],
                data: [
                    0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
                    0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,
                    0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,1,1,1,0,0,
                    0,1,1,1,2,2,2,2,2,2,2,2,2,2,2,1,1,1,0,0,
                    0,1,1,2,2,2,2,2,2,2,2,2,2,2,2,2,1,1,0,0,
                    0,1,2,2,2,1,1,1,2,2,2,1,1,1,2,2,2,1,0,0,
                    0,2,2,2,1,1,4,1,1,2,1,1,4,1,1,2,2,2,0,0,
                    0,2,2,2,1,4,4,4,1,2,1,4,4,4,1,2,2,2,0,0,
                    0,2,2,2,1,1,4,1,1,2,1,1,4,1,1,2,2,2,0,0,
                    0,2,2,2,2,1,1,1,2,5,2,1,1,1,2,2,2,2,0,0,
                    0,0,2,2,2,2,2,2,2,5,2,2,2,2,2,2,2,0,0,0,
                    0,0,0,2,2,2,2,2,2,2,2,2,2,2,2,2,0,0,0,0,
                    0,0,2,2,2,2,3,3,3,3,3,3,2,2,2,2,0,0,0,1,
                    0,2,2,2,3,3,3,3,3,3,3,3,3,3,2,2,2,0,1,1,
                    0,2,2,3,3,3,3,3,3,3,3,3,3,3,3,2,2,1,1,1,
                    0,2,2,3,3,3,3,3,3,3,3,3,3,3,3,2,2,1,1,1,
                    1,2,2,3,3,3,3,3,3,3,3,3,3,3,3,2,2,1,1,1,
                    1,1,2,2,3,3,3,3,3,3,3,3,3,3,2,2,1,1,1,0,
                    1,1,1,2,2,3,3,3,3,3,3,3,3,2,2,1,1,1,0,0,
                    1,1,1,1,2,2,2,2,2,2,2,2,2,2,1,1,1,0,0,0
                ]
            },
            {
                name: "Golden Snitch",
                rows: 11,
                cols: 15,
                palette: [
                    { id: 1, color: '#DAA520', label: '1' },
                    { id: 2, color: '#B0C4DE', label: '2' },
                    { id: 3, color: '#B8860B', label: '3' },
                ],
                data: [
                   0, 0, 2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 2, 0, 0,
                   0, 2, 2, 2, 0, 0, 0, 0, 0, 0, 0, 2, 2, 2, 0,
                   2, 2, 0, 2, 2, 0, 0, 0, 0, 0, 2, 2, 0, 2, 2,
                   2, 0, 0, 0, 2, 0, 1, 1, 1, 0, 2, 0, 0, 0, 2,
                   0, 0, 0, 0, 0, 1, 1, 3, 1, 1, 0, 0, 0, 0, 0,
                   0, 0, 0, 0, 1, 1, 3, 3, 3, 1, 1, 0, 0, 0, 0,
                   0, 0, 0, 0, 1, 1, 3, 3, 3, 1, 1, 0, 0, 0, 0,
                   0, 0, 0, 0, 0, 1, 1, 3, 1, 1, 0, 0, 0, 0, 0,
                   0, 0, 0, 0, 0, 0, 1, 1, 1, 0, 0, 0, 0, 0, 0,
                   0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
                   0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0
                ]
            }
        ];

        // --- GAME STATE ---
        let currentLevelIndex = 0;
        let selectedColorId = 1;
        let gridState = [];

        // --- DOM ELEMENTS ---
        const gridEl = document.getElementById('grid');
        const paletteContentEl = document.getElementById('palette-content');
        const titleEl = document.getElementById('level-title');
        const winMsg = document.getElementById('win-message');
        const zoomSlider = document.getElementById('zoom-slider');

        // --- INIT ---
        function initGame() {
            loadLevel(currentLevelIndex);
        }

        // --- ZOOM LOGIC ---
        function updateZoom(val) {
            // Update the CSS variable --cell-size
            document.documentElement.style.setProperty('--cell-size', val + 'px');
        }

        // --- LEVEL LOADING ---
        function loadLevel(index) {
            if (index >= levels.length) index = 0;
            currentLevelIndex = index;
            const level = levels[index];

            titleEl.textContent = level.name;
            winMsg.style.display = 'none';
            gridEl.innerHTML = '';
            paletteContentEl.innerHTML = '';
            gridState = new Array(level.data.length).fill(0);

            // Set Grid Dimensions CSS
            gridEl.style.setProperty('--cols', level.cols);
            gridEl.style.setProperty('--rows', level.rows);
            
            // Set default zoom based on grid size (Start zoomed out for overview)
            let startZoom = 35;
            if(level.cols > 15) startZoom = 30;
            zoomSlider.value = startZoom;
            updateZoom(startZoom);

            // Generate Grid Cells
            level.data.forEach((colorId, i) => {
                const cell = document.createElement('div');
                cell.classList.add('pixel');
                cell.dataset.index = i;
                cell.dataset.targetColor = colorId;

                if (colorId === 0) {
                    cell.style.backgroundColor = 'transparent';
                    cell.style.cursor = 'default';
                } else {
                    cell.textContent = colorId;
                    // Add Pointer Events (better for touch)
                    cell.addEventListener('pointerdown', handlePixelClick);
                }
                gridEl.appendChild(cell);
            });

            // Generate Palette
            level.palette.forEach((p, i) => {
                const btn = document.createElement('div');
                btn.classList.add('color-btn');
                btn.style.backgroundColor = p.color;
                btn.textContent = p.label;
                btn.dataset.id = p.id;

                if (['#FFF8E1', '#ffdbac', '#B0C4DE', '#eeba30', '#ffcccc'].includes(p.color)) {
                    btn.classList.add('light-text');
                }

                btn.addEventListener('click', () => selectColor(p.id, btn));
                paletteContentEl.appendChild(btn);

                if (i === 0) selectColor(p.id, btn);
            });
        }

        function selectColor(id, btnElement) {
            selectedColorId = id;
            document.querySelectorAll('.color-btn').forEach(b => b.classList.remove('selected'));
            btnElement.classList.add('selected');
        }

        function handlePixelClick(e) {
            e.preventDefault(); 
            const cell = e.target;
            const targetId = parseInt(cell.dataset.targetColor);
            const index = parseInt(cell.dataset.index);

            if (targetId === selectedColorId) {
                if (!cell.classList.contains('filled')) {
                    const colorObj = levels[currentLevelIndex].palette.find(c => c.id === targetId);
                    cell.style.backgroundColor = colorObj.color;
                    cell.classList.add('filled');
                    gridState[index] = targetId; 
                    checkWin();
                }
            } else {
                // Shake effect using simple transform
                // (Note: works best when not transitioning zoom, but acceptable here)
                cell.style.opacity = "0.5";
                setTimeout(() => cell.style.opacity = "1", 200);
            }
        }

        function checkWin() {
            const level = levels[currentLevelIndex];
            const totalPixelsToFill = level.data.filter(x => x !== 0).length;
            const filledPixels = document.querySelectorAll('.pixel.filled').length;

            if (filledPixels === totalPixelsToFill) {
                setTimeout(() => {
                    winMsg.style.display = 'flex';
                    triggerConfetti();
                }, 300);
            }
        }

        function nextLevel() {
            currentLevelIndex++;
            loadLevel(currentLevelIndex);
        }

        function resetLevel() {
            loadLevel(currentLevelIndex);
        }

        function triggerConfetti() {
            const count = 200;
            const defaults = { origin: { y: 0.7 }, zIndex: 1000 };

            function fire(particleRatio, opts) {
                confetti(Object.assign({}, defaults, opts, {
                    particleCount: Math.floor(count * particleRatio)
                }));
            }

            fire(0.25, { spread: 26, startVelocity: 55 });
            fire(0.2, { spread: 60 });
            fire(0.35, { spread: 100, decay: 0.91, scalar: 0.8 });
            fire(0.1, { spread: 120, startVelocity: 25, decay: 0.92, scalar: 1.2 });
            fire(0.1, { spread: 120, startVelocity: 45 });
        }

        // Start
        initGame();

    </script>
</body>
</html>
